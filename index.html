<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Watermelon Fireworks Celebration</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #0f0f1e;
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height for mobile */
            position: fixed;
            top: 0;
            left: 0;
        }
        canvas {
            display: block;
            background: linear-gradient(to bottom, #0f0f1e 0%, #1a1a2e 40%, #16213e 100%);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="celebrationCanvas"></canvas>
    
    <script>
        const canvas = document.getElementById('celebrationCanvas');
        const ctx = canvas.getContext('2d');
        
        // Layout configuration object
        const layoutConfig = {
            desktop: {
                canvasWidth: 800,
                canvasHeight: 600,
                personX: 120,
                womanX: 680,
                personY: 480
            },
            mobilePortrait: {
                canvasWidth: 400,
                canvasHeight: 700,
                personX: 50,
                womanX: 350,
                personY: 580
            },
            mobileLandscape: {
                canvasWidth: 700,
                canvasHeight: 400,
                personX: 80,
                womanX: 620,
                personY: 280
            }
        };
        
        // Current layout mode
        let currentLayout = 'desktop';
        
        // Responsive canvas sizing
        function resizeCanvas() {
            // Use visualViewport for mobile browsers to account for UI elements
            const windowWidth = window.visualViewport ? window.visualViewport.width : window.innerWidth;
            const windowHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
            const isMobile = windowWidth <= 768 || windowHeight <= 768;
            const isPortrait = windowHeight > windowWidth;
            
            let config;
            
            if (isMobile && isPortrait) {
                currentLayout = 'mobilePortrait';
                config = layoutConfig.mobilePortrait;
            } else if (isMobile && !isPortrait) {
                currentLayout = 'mobileLandscape';
                config = layoutConfig.mobileLandscape;
            } else {
                currentLayout = 'desktop';
                config = layoutConfig.desktop;
            }
            
            // Use full window dimensions
            canvas.width = windowWidth;
            canvas.height = windowHeight;
            
            // Store current config globally
            window.currentConfig = config;
        }
        
        // Initial resize
        resizeCanvas();
        
        // Function to reinitialize objects on resize
        function reinitializeObjects() {
            resizeCanvas();
            person = new Person();
            woman = new Woman();
            school = new School();
        }
        
        // Handle window resize
        window.addEventListener('resize', reinitializeObjects);
        
        // Handle mobile viewport changes (keyboard, browser UI, etc.)
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', () => {
                resizeCanvas();
            });
        }
        
        // Handle orientation change on mobile
        window.addEventListener('orientationchange', () => {
            setTimeout(reinitializeObjects, 100);
        });
        
        // Particle class for explosion effects
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 6;
                this.vy = (Math.random() - 0.5) * 6;
                this.size = Math.random() * 3 + 1;
                this.color = color;
                this.life = 1;
                this.decay = Math.random() * 0.015 + 0.005;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.05; // gravity
                this.vx *= 0.99; // friction
                this.life -= this.decay;
                this.size *= 0.99;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // Watermelon slice class (after breaking)
        class WatermelonSlice {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = -Math.random() * 5 - 2; // Bounce up
                this.size = 10 + Math.random() * 15;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.3;
                this.life = 1;
                this.gravity = 0.2;
                // Generate random seed positions for this slice
                this.seeds = [];
                for (let i = 0; i < 3 + Math.floor(Math.random() * 2); i++) {
                    this.seeds.push({
                        x: (Math.random() - 0.5) * this.size * 0.6,
                        y: -this.size * (0.2 + Math.random() * 0.4)
                    });
                }
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.gravity;
                this.vx *= 0.98;
                this.rotation += this.rotationSpeed;
                
                // Fade out over time
                this.life -= 0.01;
                
                // Stop at ground
                if (this.y > canvas.height - 50) {
                    this.y = canvas.height - 50;
                    this.vy = 0;
                    this.vx *= 0.8;
                    this.rotationSpeed *= 0.9;
                    this.life -= 0.02;
                }
            }
            
            draw() {
                if (this.life <= 0) return;
                
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // Draw watermelon slice
                // Outer green rind
                ctx.fillStyle = '#2E7D32';
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI, true);
                ctx.closePath();
                ctx.fill();
                
                // Inner light green
                ctx.fillStyle = '#66BB6A';
                ctx.beginPath();
                ctx.arc(0, 0, this.size * 0.9, 0, Math.PI, true);
                ctx.closePath();
                ctx.fill();
                
                // Red flesh
                ctx.fillStyle = '#E53935';
                ctx.beginPath();
                ctx.arc(0, 0, this.size * 0.8, 0, Math.PI, true);
                ctx.closePath();
                ctx.fill();
                
                // Seeds (randomly positioned on the red flesh)
                ctx.fillStyle = '#000';
                this.seeds.forEach(seed => {
                    ctx.beginPath();
                    ctx.ellipse(seed.x, seed.y, 1.5, 2, Math.random() * Math.PI, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                ctx.restore();
            }
            
            isAlive() {
                return this.life > 0;
            }
        }
        
        // Full Watermelon class (falling from explosions)
        class Watermelon {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 4; // Horizontal velocity from explosion
                this.vy = (Math.random() - 0.5) * 2 - 1; // Initial upward/sideways velocity
                this.size = 20 + Math.random() * 15;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
                this.broken = false;
                this.slices = [];
                this.particles = []; // Initialize particles array
                this.gravity = 0.15; // Slower gravity
            }
            
            update() {
                if (!this.broken) {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += this.gravity; // Apply gravity
                    this.vx *= 0.995; // Air resistance
                    this.rotation += this.rotationSpeed;
                    
                    // Break when hitting ground
                    if (this.y + this.size > canvas.height - 50) {
                        this.break();
                    }
                } else {
                    // Update slices
                    this.slices = this.slices.filter(slice => {
                        slice.update();
                        return slice.isAlive();
                    });
                    
                    // Update particles
                    this.particles = this.particles.filter(particle => {
                        particle.update();
                        return particle.life > 0;
                    });
                }
            }
            
            break() {
                this.broken = true;
                // Create slices
                const sliceCount = 4 + Math.floor(Math.random() * 3);
                for (let i = 0; i < sliceCount; i++) {
                    this.slices.push(new WatermelonSlice(this.x, this.y));
                }
                
                // Create splash particles
                for (let i = 0; i < 10; i++) {
                    this.particles.push(new Particle(this.x, this.y, '#E53935'));
                }
            }
            
            draw() {
                if (!this.broken) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.rotation);
                    
                    // Draw full watermelon with glow
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#4CAF50';
                    
                    // Dark green stripes pattern
                    const stripes = 8;
                    for (let i = 0; i < stripes; i++) {
                        ctx.fillStyle = i % 2 === 0 ? '#2E7D32' : '#1B5E20';
                        ctx.beginPath();
                        ctx.arc(0, 0, this.size, (i * Math.PI * 2) / stripes, ((i + 1) * Math.PI * 2) / stripes);
                        ctx.lineTo(0, 0);
                        ctx.closePath();
                        ctx.fill();
                    }
                    
                    // Add highlight for 3D effect
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.beginPath();
                    ctx.arc(-this.size * 0.3, -this.size * 0.3, this.size * 0.4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.restore();
                } else {
                    // Draw particles
                    this.particles.forEach(particle => particle.draw());
                    
                    // Draw slices
                    this.slices.forEach(slice => slice.draw());
                }
            }
            
            isAlive() {
                return !this.broken || this.slices.length > 0 || this.particles.length > 0;
            }
        }
        
        // Firework class
        class Firework {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = canvas.height;
                this.targetY = 50 + Math.random() * 100; // Explosion height - much higher (50-150 from top)
                this.vy = -12 - Math.random() * 4; // Faster launch speed to reach higher
                this.vx = (Math.random() - 0.5) * 1; // Slight horizontal movement
                this.trail = [];
                this.exploded = false;
                this.particles = [];
                this.watermelons = [];
                this.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
            }
            
            update() {
                if (!this.exploded) {
                    // Rising phase
                    this.y += this.vy;
                    this.x += this.vx;
                    this.vy += 0.12; // Slower gravity effect
                    
                    // Add to trail
                    this.trail.push({ x: this.x, y: this.y, life: 1 });
                    
                    // Update trail
                    this.trail = this.trail.filter(point => {
                        point.life -= 0.03;
                        return point.life > 0;
                    });
                    
                    // Check if reached target height or started falling
                    if (this.y <= this.targetY || this.vy >= 0) {
                        this.explode();
                    }
                } else {
                    // Update explosion particles
                    this.particles = this.particles.filter(particle => {
                        particle.update();
                        return particle.life > 0;
                    });
                    
                    // Update watermelons
                    this.watermelons = this.watermelons.filter(watermelon => {
                        watermelon.update();
                        return watermelon.isAlive();
                    });
                }
            }
            
            explode() {
                this.exploded = true;
                
                // Create explosion particles
                for (let i = 0; i < 40; i++) {
                    this.particles.push(new Particle(this.x, this.y, this.color));
                }
                
                // Create full watermelons from explosion
                const watermelonCount = 3 + Math.floor(Math.random() * 3);
                for (let i = 0; i < watermelonCount; i++) {
                    this.watermelons.push(new Watermelon(this.x, this.y));
                }
            }
            
            draw() {
                if (!this.exploded) {
                    // Draw trail
                    this.trail.forEach(point => {
                        ctx.save();
                        ctx.globalAlpha = point.life * 0.5;
                        ctx.fillStyle = '#FFD700';
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = '#FFD700';
                        ctx.beginPath();
                        ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    });
                    
                    // Draw firework rocket
                    ctx.save();
                    ctx.fillStyle = '#FFD700';
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                } else {
                    // Draw explosion particles
                    this.particles.forEach(particle => particle.draw());
                    
                    // Draw watermelons
                    this.watermelons.forEach(watermelon => watermelon.draw());
                }
            }
            
            isComplete() {
                return this.exploded && this.particles.length === 0 && this.watermelons.length === 0;
            }
        }
        
        // Person class
        class Person {
            constructor() {
                const config = window.currentConfig || layoutConfig.desktop;
                this.x = config.personX;
                this.y = config.personY;
                this.armAngle = 0;
                this.jumpOffset = 0;
                this.jumpSpeed = 0.1;
                this.excitement = 0;
                this.currentMessage = null;
                this.messageTimer = 0;
                this.messageDisplayTime = 120; // frames to display message (about 2 seconds at 60fps)
                this.messageCooldown = 0;
                this.messageCooldownTime = 180; // frames between messages (about 3 seconds)
            }
            
            update() {
                // Animated cheering motion
                this.armAngle = Math.sin(Date.now() * 0.005) * 0.5 + 0.2;
                this.jumpOffset = Math.abs(Math.sin(Date.now() * 0.003)) * 20;
                this.excitement = Math.sin(Date.now() * 0.01) * 0.2;
                
                // Handle message timing
                if (this.currentMessage) {
                    this.messageTimer--;
                    if (this.messageTimer <= 0) {
                        this.currentMessage = null;
                        this.messageCooldown = this.messageCooldownTime;
                    }
                } else if (this.messageCooldown > 0) {
                    this.messageCooldown--;
                } else {
                    // Chance to show new message
                    if (Math.random() > 0.98) {
                        let messages = ['YAY!', 'WOO!', 'YEAH!', '🎉', 'AWESOME!'];
                        this.currentMessage = messages[Math.floor(Math.random() * messages.length)];
                        this.messageTimer = this.messageDisplayTime;
                    }
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y - this.jumpOffset);
                
                // Shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.ellipse(0, 80 + this.jumpOffset, 40, 10, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Body
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(-30, -20, 60, 60);
                
                // Head
                ctx.fillStyle = '#FFDBAC';
                ctx.beginPath();
                ctx.arc(0, -50, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Hair
                ctx.fillStyle = '#3E2723';
                ctx.beginPath();
                ctx.ellipse(0, -65, 24, 18, 0, Math.PI, 0, false);
                ctx.closePath();
                ctx.fill();
                
                // Hair fringe/bangs
                ctx.beginPath();
                ctx.arc(-10, -68, 8, 0, Math.PI * 2);
                ctx.arc(0, -70, 8, 0, Math.PI * 2);
                ctx.arc(10, -68, 8, 0, Math.PI * 2);
                ctx.fill();
                
                // Face - Happy expression
                ctx.fillStyle = '#000';
                // Eyes (excited)
                ctx.beginPath();
                ctx.arc(-8, -55, 3, 0, Math.PI * 2);
                ctx.arc(8, -55, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Big smile
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, -45, 12, 0.2, Math.PI - 0.2);
                ctx.stroke();
                
                // Arms (raised in celebration)
                ctx.strokeStyle = '#FFDBAC';
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                
                // Left arm
                ctx.beginPath();
                ctx.moveTo(-25, -10);
                ctx.lineTo(-40, -30 - Math.sin(this.armAngle) * 20);
                ctx.lineTo(-35, -55 - Math.sin(this.armAngle) * 30);
                ctx.stroke();
                
                // Right arm
                ctx.beginPath();
                ctx.moveTo(25, -10);
                ctx.lineTo(40, -30 - Math.sin(this.armAngle + Math.PI) * 20);
                ctx.lineTo(35, -55 - Math.sin(this.armAngle + Math.PI) * 30);
                ctx.stroke();
                
                // Legs
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 10;
                
                // Left leg
                ctx.beginPath();
                ctx.moveTo(-15, 40);
                ctx.lineTo(-15 - this.jumpOffset * 0.3, 70);
                ctx.stroke();
                
                // Right leg
                ctx.beginPath();
                ctx.moveTo(15, 40);
                ctx.lineTo(15 + this.jumpOffset * 0.3, 70);
                ctx.stroke();
                
                // Celebration text
                if (this.currentMessage) {
                    ctx.fillStyle = '#FFD700';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#FFD700';
                    ctx.fillText(this.currentMessage, 0, -90);
                }
                
                ctx.restore();
            }
        }
        
        // School building class
        class School {
            constructor() {
                this.x = window.currentConfig.canvasWidth / 2 - 250;
                this.y = window.currentConfig.canvasHeight - 50 - 260; // Position so bottom touches ground
                this.width = 500;
                this.height = 260;
            }
            
            draw() {
                ctx.save();
                
                // Main building center section - 2 stories
                ctx.fillStyle = '#D4A76A';
                ctx.fillRect(this.x + 150, this.y + 30, 200, this.height - 30);
                
                // Triangular roof on main building
                ctx.fillStyle = '#5D4037';
                ctx.beginPath();
                ctx.moveTo(this.x + 130, this.y + 30);
                ctx.lineTo(this.x + 250, this.y - 20);
                ctx.lineTo(this.x + 370, this.y + 30);
                ctx.closePath();
                ctx.fill();
                
                // Left wing extension (comes forward)
                ctx.fillStyle = '#C8986B';
                ctx.fillRect(this.x + 50, this.y + 80, 120, 180);
                
                // Right wing extension (comes forward)
                ctx.fillStyle = '#C8986B';
                ctx.fillRect(this.x + 330, this.y + 80, 120, 180);
                
                
                // Second story tall glass windows (front only)
                ctx.fillStyle = 'rgba(70, 130, 180, 0.8)';
                for (let i = 0; i < 4; i++) {
                    ctx.fillRect(this.x + 165 + i * 45, this.y + 50, 35, 100);
                    
                    // Window frames
                    ctx.strokeStyle = '#2C3E50';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(this.x + 165 + i * 45, this.y + 50, 35, 100);
                    
                    // Horizontal divider in each window
                    ctx.beginPath();
                    ctx.moveTo(this.x + 165 + i * 45, this.y + 100);
                    ctx.lineTo(this.x + 200 + i * 45, this.y + 100);
                    ctx.stroke();
                }
                
                // Large arched entrance area
                ctx.fillStyle = '#E8DCC6';
                // Draw large semicircle arch
                ctx.beginPath();
                ctx.arc(this.x + 250, this.y + 220, 50, Math.PI, 0, false);
                ctx.closePath();
                ctx.fill();
                
                // Fill the rectangular area below the arch
                ctx.fillRect(this.x + 200, this.y + 220, 100, 40);
                
                // Main entrance doors (double doors)
                ctx.fillStyle = '#1A1A1A';
                ctx.fillRect(this.x + 215, this.y + 210, 35, 50);
                ctx.fillRect(this.x + 250, this.y + 210, 35, 50);
                
                // Door windows
                ctx.fillStyle = 'rgba(70, 130, 180, 0.5)';
                ctx.fillRect(this.x + 219, this.y + 215, 27, 18);
                ctx.fillRect(this.x + 254, this.y + 215, 27, 18);
                
                // Door handles
                ctx.fillStyle = '#888';
                ctx.beginPath();
                ctx.arc(this.x + 240, this.y + 240, 2, 0, Math.PI * 2);
                ctx.arc(this.x + 260, this.y + 240, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Center divider between doors
                ctx.strokeStyle = '#666';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.x + 250, this.y + 210);
                ctx.lineTo(this.x + 250, this.y + 260);
                ctx.stroke();
                
                // First floor windows on wings
                // Left wing windows
                for (let i = 0; i < 2; i++) {
                    for (let j = 0; j < 2; j++) {
                        ctx.fillStyle = 'rgba(100, 150, 200, 0.6)';
                        ctx.fillRect(this.x + 70 + i * 50, this.y + 110 + j * 70, 40, 50);
                        ctx.strokeStyle = '#2C3E50';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(this.x + 70 + i * 50, this.y + 110 + j * 70, 40, 50);
                    }
                }
                
                // Right wing windows
                for (let i = 0; i < 2; i++) {
                    for (let j = 0; j < 2; j++) {
                        ctx.fillStyle = 'rgba(100, 150, 200, 0.6)';
                        ctx.fillRect(this.x + 350 + i * 50, this.y + 110 + j * 70, 40, 50);
                        ctx.strokeStyle = '#2C3E50';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(this.x + 350 + i * 50, this.y + 110 + j * 70, 40, 50);
                    }
                }
                
                // Flat roof lines on wings only
                ctx.fillStyle = '#4A4A4A';
                ctx.fillRect(this.x + 45, this.y + 75, 130, 6);
                ctx.fillRect(this.x + 325, this.y + 75, 130, 6);
                
                // School name below windows, above entrance
                ctx.fillStyle = '#2C3E50';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('CR SOUTH', this.x + 250, this.y + 170);
                
                ctx.restore();
            }
        }
        
        // Stars in background
        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * (canvas.height - 100);
                this.size = Math.random() * 2;
                this.twinkle = Math.random() * Math.PI * 2;
            }
            
            update() {
                this.twinkle += 0.02;
            }
            
            draw() {
                ctx.save();
                ctx.fillStyle = '#fff';
                ctx.globalAlpha = 0.3 + Math.sin(this.twinkle) * 0.3;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // Create stars
        const stars = [];
        for (let i = 0; i < 50; i++) {
            stars.push(new Star());
        }
        
        // Create school
        let school = new School();
        
        // Woman class
        class Woman {
            constructor() {
                const config = window.currentConfig || layoutConfig.desktop;
                this.x = config.womanX;
                this.y = config.personY;
                this.armAngle = 0;
                this.jumpOffset = 0;
                this.jumpSpeed = 0.1;
                this.excitement = 0;
                this.currentMessage = null;
                this.messageTimer = 0;
                this.messageDisplayTime = 120;
                this.messageCooldown = 0;
                this.messageCooldownTime = 180;
            }
            
            update() {
                // Animated cheering motion (offset from man's timing)
                this.armAngle = Math.sin(Date.now() * 0.005 + Math.PI) * 0.5 + 0.2;
                this.jumpOffset = Math.abs(Math.sin(Date.now() * 0.003 + Math.PI/2)) * 20;
                this.excitement = Math.sin(Date.now() * 0.01) * 0.2;
                
                // Handle message timing
                if (this.currentMessage) {
                    this.messageTimer--;
                    if (this.messageTimer <= 0) {
                        this.currentMessage = null;
                        this.messageCooldown = this.messageCooldownTime;
                    }
                } else if (this.messageCooldown > 0) {
                    this.messageCooldown--;
                } else {
                    // Chance to show new message
                    if (Math.random() > 0.98) {
                        let messages = ['WOOHOO!', 'YES!', 'AMAZING!', '❤️', 'SO HAPPY!'];
                        this.currentMessage = messages[Math.floor(Math.random() * messages.length)];
                        this.messageTimer = this.messageDisplayTime;
                    }
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y - this.jumpOffset);
                
                // Shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.ellipse(0, 80 + this.jumpOffset, 40, 10, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Body - dress
                ctx.fillStyle = '#E91E63';
                ctx.beginPath();
                ctx.moveTo(-25, -20);
                ctx.lineTo(25, -20);
                ctx.lineTo(35, 40);
                ctx.lineTo(-35, 40);
                ctx.closePath();
                ctx.fill();
                
                // Head
                ctx.fillStyle = '#FFDBAC';
                ctx.beginPath();
                ctx.arc(0, -50, 25, 0, Math.PI * 2);
                ctx.fill();
                
                // Hair - longer style
                ctx.fillStyle = '#6D4C41';
                ctx.beginPath();
                // Top of hair
                ctx.arc(0, -60, 26, Math.PI, 0, false);
                ctx.closePath();
                ctx.fill();
                
                // Side hair strands
                ctx.beginPath();
                ctx.ellipse(-20, -45, 12, 20, -0.3, 0, Math.PI * 2);
                ctx.ellipse(20, -45, 12, 20, 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // Face - Happy expression
                ctx.fillStyle = '#000';
                // Eyes
                ctx.beginPath();
                ctx.arc(-8, -55, 3, 0, Math.PI * 2);
                ctx.arc(8, -55, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Smile
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, -45, 12, 0.2, Math.PI - 0.2);
                ctx.stroke();
                
                // Arms (raised in celebration)
                ctx.strokeStyle = '#FFDBAC';
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                
                // Left arm
                ctx.beginPath();
                ctx.moveTo(-20, -10);
                ctx.lineTo(-35, -30 - Math.sin(this.armAngle) * 20);
                ctx.lineTo(-30, -55 - Math.sin(this.armAngle) * 30);
                ctx.stroke();
                
                // Right arm
                ctx.beginPath();
                ctx.moveTo(20, -10);
                ctx.lineTo(35, -30 - Math.sin(this.armAngle + Math.PI) * 20);
                ctx.lineTo(30, -55 - Math.sin(this.armAngle + Math.PI) * 30);
                ctx.stroke();
                
                // Legs
                ctx.strokeStyle = '#FFDBAC';
                ctx.lineWidth = 10;
                
                // Left leg
                ctx.beginPath();
                ctx.moveTo(-10, 40);
                ctx.lineTo(-10 - this.jumpOffset * 0.3, 70);
                ctx.stroke();
                
                // Right leg
                ctx.beginPath();
                ctx.moveTo(10, 40);
                ctx.lineTo(10 + this.jumpOffset * 0.3, 70);
                ctx.stroke();
                
                // Shoes
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.ellipse(-10 - this.jumpOffset * 0.3, 75, 8, 5, 0, 0, Math.PI * 2);
                ctx.ellipse(10 + this.jumpOffset * 0.3, 75, 8, 5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Celebration text
                if (this.currentMessage) {
                    ctx.fillStyle = '#FFD700';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#FFD700';
                    ctx.fillText(this.currentMessage, 0, -90);
                }
                
                ctx.restore();
            }
        }
        
        // Create person
        let person = new Person();
        
        // Create woman
        let woman = new Woman();
        
        // Fireworks array
        const fireworks = [];
        let fireworkTimer = 0;
        
        // Animation loop
        function animate() {
            // Save the current transformation matrix
            ctx.save();
            
            // Clear canvas at full size (before scaling)
            ctx.fillStyle = 'rgba(15, 15, 30, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Calculate scale factors
            const scaleX = canvas.width / window.currentConfig.canvasWidth;
            const scaleY = canvas.height / window.currentConfig.canvasHeight;
            
            // Apply scaling for drawing
            ctx.scale(scaleX, scaleY);
            
            // Draw stars
            stars.forEach(star => {
                star.update();
                star.draw();
            });
            
            // Draw ground (using original dimensions)
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, window.currentConfig.canvasHeight - 50, window.currentConfig.canvasWidth, 50);
            
            // Ground highlight
            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, window.currentConfig.canvasHeight - 50, window.currentConfig.canvasWidth, 5);
            
            // Draw school building
            school.draw();
            
            // Launch new fireworks periodically (slower)
            fireworkTimer++;
            if (fireworkTimer > 80 + Math.random() * 60) { // Much slower launches
                fireworks.push(new Firework());
                fireworkTimer = 0;
            }
            
            // Update and draw fireworks
            for (let i = fireworks.length - 1; i >= 0; i--) {
                const firework = fireworks[i];
                firework.update();
                firework.draw();
                
                if (firework.isComplete()) {
                    fireworks.splice(i, 1);
                }
            }
            
            // Update and draw person
            person.update();
            person.draw();
            
            // Update and draw woman
            woman.update();
            woman.draw();
            
            // Draw title - clean and simple
            ctx.textAlign = 'center';
            
            // Readable font size
            const fontSize = Math.min(48, window.currentConfig.canvasWidth * 0.06);
            const titleY = Math.min(70, window.currentConfig.canvasHeight * 0.1);
            
            // Simple white text with subtle shadow
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 4;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            // Clean white text
            ctx.fillStyle = '#FFFFFF';
            ctx.font = `${fontSize}px Arial, sans-serif`;
            ctx.fillText('Happy 10 Year Reunion', window.currentConfig.canvasWidth / 2, titleY);
            
            ctx.restore();
            
            requestAnimationFrame(animate);
        }
        
        // Start animation
        animate();
        
        // Touch/click interaction for mobile
        function handleInteraction(e) {
            e.preventDefault();
            
            // Get coordinates
            let x, y;
            if (e.touches) {
                const rect = canvas.getBoundingClientRect();
                x = (e.touches[0].clientX - rect.left) * (canvas.width / rect.width);
                y = (e.touches[0].clientY - rect.top) * (canvas.height / rect.height);
            } else {
                const rect = canvas.getBoundingClientRect();
                x = (e.clientX - rect.left) * (canvas.width / rect.width);
                y = (e.clientY - rect.top) * (canvas.height / rect.height);
            }
            
            // Launch firework from touch/click position
            const firework = new Firework();
            firework.x = x;
            firework.targetY = Math.max(75, y - 50);
            fireworks.push(firework);
        }
        
        // Add event listeners for interaction
        canvas.addEventListener('click', handleInteraction);
        canvas.addEventListener('touchstart', handleInteraction);
        
        // Prevent default touch behaviors
        canvas.addEventListener('touchmove', (e) => e.preventDefault());
        canvas.addEventListener('touchend', (e) => e.preventDefault());
    </script>
</body>
</html>